# python数据处理

> 笔记所记录的内容大部分出至《数据科学技术与应用》,还有些是我学习中遇到的问题，穿插其中补充。

## 第1章 数据科学基础

### 1.3 python语言基础

#### 1.3.1 常用数据类型

1. 字符串(string)

   **任何类型都可以使用内置函数str()转换为字符串**

2. 元组tuple和列表list(两者是有序元素序列)

   + tuple()的元素不可修改，list[]可以修改

   + tuple的元素使用“变量名[索引]”来表示，索引范围由[0,n-10] or [-n,-1]

   + tuple和list的相互转换

     ```python
     #tuple转list
     list(tuple对象)
     #list转tuple
     tuple(list对象)
     ```

     

3. 字典dictionary(无序键值对)

   + dictionary{xx:yy}

#### 1.3.2 流程控制

1. 注释

   + 单行注释# 被注释的代码
   + 多行注释 """  被多行注释的代码  """

2. 分支结构(if-else)

   ```python
   if XXX:
   
   	代码1
   
   else if YYY:
   
   	代码2
   
   else:
   
   	代码3
   ```

3. 循环结构(while,for)

   + ```python
     for xx in yy :
     
     	代码快
     ```

   + ```python
     while xxxx :
     
     	代码块
     ```

#### 1.3.3 函数和方法库

1. Python提供大量内置函数，如input,range等，大部分第三方库library,包package没加载到解释器中，需导入

   + 直接导入整个方法库或者包，调用时加上包名

     ```python
     >>> import math
     >>> math.sqrt(5)
     ```

   + 导入方法库中某个函数，调用时直接使用函数名

     ```python
     >>> from math import sqrt
     >>> sqrt(5)
     ```

   + 导入方法库中某个类或者函数并重命名，调用时使用临时替代名

     ```python
     >>> from math import sqrt as sq
     >>> sq(5)
     ```

2. Python自定义函数

   使用def关键字定义函数，函数定义时，变量类型无需说明，同时<u>可以在参数列表的最后定义多个带有默认值的参数</u>。函数调用时，具有默认值的形参，可以不传实参。

   ```python
   >>> def sum(a,b):
       print(a + b)
   >>> sum(1,2)
   3
   ```

3. 常用的方法：

   + type(对象)

     用于得到和判断指定对象的数据类型

## 第2章 多维数据结构与运算

### 2.1 多维数组对象

> NumPy库提供多维数组ndarray，其**所有元素类型必须相同**，且**大小固定**，在创建时定义，**使用过程中不可改变**。一般采用如下方式导入NumPy库：
>
> \>\>\> import numpy as np
>
> 为避免函数命名冲突，后续使用Numpy时使用np代替。

#### 2.1.1 一维数组对象

> Numpy库的array函数可以基于python的tuple和list创建ndarray对象。(亲测使用dictionary生成的对象0维，而tuple和list创建对象没有区别

1. 查看数组的属性

   ```pywhon
   np.array(xxx).ndim	#数组维度
   np.array(xxx).size	#数组元素的个数
   np.array(xxx).ndim	#数组的数据类型
   ```

2. 单个数组元素访问

   也是通过索引序号访问，一维数组的索引序号范围[0,n-1]和[-n,-1]

3. 数组切片(slicing)

   抽取数组的一部分元素生成新数组称为切片操作。切片根据给出的索引，抽取对应的元素

   ```python
   #切片方式1：传入索引列表[x,y,z,m]
   arr2 = np.array(["零","一","二","三","四","五","六","七","八"])
   print (arr2[[0,3,5]]) #得到 "['零' '三' '五']"
   
   """
   切片方式2：索引通过 start:end:step 形式给出，它生成一个等差数列，元素从start开始，end-1结束，step为步长，start默认为从头开始，end默认为最后一个元素结束，step默认步长为1
   """
   print(arr2[:-1:3]) #得到"['零' '三' '六']"
   ```

   + 使用索引列表进行切片操作时，外层的方括号表示数组索引操作，内层的方括号表示多个索引组成的列表

4. 根据条件筛选数组元素

   > Python 中 （&，|）和（and，or）之间的区别
   >
   >  https://blog.csdn.net/weixin_40041218/article/details/80868521 

   ```python
   arr2 = np.array(["零","一","二","三","四","五","六","七","八"])
   print(arr2[(arr2 == '零') | (arr2 == '三')])
   #得到结果 ['零' '三']
   
   print(arr2[(arr2 == '零') or (arr2 == '三')])
   #用or报错，这里就不贴报错信息了
   ```

   条件筛选分为2步骤，首先利用(arr2 == '零') | (arr2 == '三')条件表达式<u>创建一个布尔型的数组</u>，然后使用此对象对arr2内的元素按位置选择，值是True的选中，Flase的不选。分步骤实现代码如下：

   ```python
   arr2 = np.array(["零","一","二","三","四","五","六","七","八"])
   selector = (arr2 == '零') | (arr2 == '三')
   print(arr2[selector])
   #得到结果 ['零' '三']
   print(selector)
   # [ True False False  True False False False False False]
   ```

#### 2.1.2 二维数组对象

1. 查看数组属性

   ```python
   arr = np.array([[1,2],[3,4]])
   print(arr.ndim) # 数组维度 2
   print(arr.size) # 数组元素总数 = 行数*列数 4
   print(arr.shape) # 数组的行数和列数 (2,2)
   print(arr.dtype) # 数组元素的类型 int32
   ```

2. 二维数组切片

   二维数组切片的基本格式：

   ```python
   arr[ row , column ]
   """
   其中row为行序号，column为列序号，中间用“，”隔开。行、列切片的表示方式与一维数组相同。如果行或列用“：”代替，表示选中对应的所有行或列
   """
   ```

   1）访问指定行、列的元素，给定行和列两个索引值

   ```python
   arr = np.array([[1,2],[3,4,5,6],[7,8,9]])
   print(arr)
   # [list([1, 2]) list([3, 4, 5, 6]) list([7, 8, 9])]
   print(arr[2][2])
   # 9
   # 上面这是一维的，不过元素是list对象,访问arr[0,1]报错,不贴error信息
   arr = np.array([[1,2,3,4],[5,6,7,8],[9,10,11,12]])
   print(arr)
   """
   [[ 1  2  3  4]
    [ 5  6  7  8]
    [ 9 10 11 12]]
   """
   print(arr[2,3])
   # 12
   print(arr[[0,1],[1,2],[2,3]])
   # IndexError: too many indices for array
   a = arr[[0,2],[1,3]]
   print(type(a))
   # <class 'numpy.ndarray'>
   print(arr[[0,2],[1,3]])
   # [ 2 12]
   ```

   + 上例在方括号中给出行切片[0,2]和列切片[1,3]，表示抽取行序号为0、列序号为1，以及行序号为2、列序号为3的元素，**得到一维的ndarray数组**

   2）访问部分行元素，给出行列表即可，**列索引的":"可以省略**

   ```python
   print(arr[[0,1]])
   """
   [[1 2 3 4]
    [5 6 7 8]]
   """
   print(arr[[0,1],:])
   """
   [[1 2 3 4]
    [5 6 7 8]]
   """
   ```

   3）访问部分列元素，**前面的行索引“:"不能省略**，否则无法识别是对列切片

   ```python
   print(arr[,[0,1]])
   # SyntaxError: invalid syntax
   print(arr[:,[0,1]])
   """
   [[ 1  2]
    [ 5  6]
    [ 9 10]]
   """
   print(arr[0:2:1,[0,1]])
   # [[1 2]]
   print(arr[0:2:1,[0,1]])
   """
   [[1 2]
    [5 6]]
   """
   print(arr[0:3:1,[0,1]])
   """
   [[ 1  2]
    [ 5  6]
    [ 9 10]]
   """
   ```

   + 后面几条尝试了前面提到的start: end: step形式，可以看出end是不包含的，也就是区间是[start,end)​

   4）**访问部分行和列数据**

   ```python
   arr = np.array([[1,2,3,4],[5,6,7,8],[9,10,11,12]])
   print(arr[ [0,2] , 1:3 ]) # 0、2行中1~2列的所有元素
   """
   [[ 2  3]
    [10 11]]
   """
   ```

   如果需要抽取指定**某些行中指定列**的所有元素，则需要进行**两层切片**

   ```python
   print(arr[0,1][:,[0,3]])
   # IndexError: invalid index to scalar variable.
   print(arr[[0,1]][:,[0,3]])
   """
   [[1 4]
    [5 8]]
   """
   #首先arr[[0,1]]抽取指定0、1行组成的二维ndarray对象，再在此对象上进行切片操作，取所有行中0、3列的元素
   ```

3. 条件筛选

   可以使用布尔型数组筛选访问其他数组的元素。用于筛选的布尔数组，<u>需要具有与访问数组相同的函数或列数</u>。

   ```python
   flag = np.array(['one','two','three'])
   arr = np.array([[1,2,3,4],[5,6,7,8],[9,10,11,12]])
   selector = (flag == 'one') | (flag == 'three')
   print(selector)
   print(arr[selector])
   """
   [ True False  True]
   [[ 1  2  3  4]
    [ 9 10 11 12]]
   """
   flag = np.array(['one','two','three','four'])
   arr = np.array([[1,2,3,4],[5,6,7,8],[9,10,11,12]])
   selector = (flag == 'one') | (flag == 'three')
   print(selector)
   print(arr[:,selector])
   """
   [ True False  True False]
   [[ 1  3]
    [ 5  7]
    [ 9 11]]
   """
   ```

#### 2.1.3 创建多维数组的常用方法

1. arange()函数

   生成指定头、尾、步长的<u>等差数组</u>，**参数可以是浮点数**

   ```python
   np.arange(4)
   # array([0, 1, 2, 3])
   np.arange(0,4)
   # array([0, 1, 2, 3])
   np.arange(0,5,2)
   # array([0, 2, 4])
   np.arange(0.3,2.2,0.3)
   # array([0.3, 0.6, 0.9, 1.2, 1.5, 1.8, 2.1])
   ```

2. reshape()函数

   将一维数组转换为指定的多维数组

   ```python
   # arr.reshape(m,n) 获取arr转换为m行n列的新数组
   arr1 = np.array([1,2,3,4,5,6,7,8,9])
   arr2 = arr1.reshape(3,3)
   print(arr2)
   """
   [[1 2 3]
    [4 5 6]
    [7 8 9]]
   """
   ```

3. zeros()函数和ones()函数

   zeros()函数和ones()函数生成指定大小全0和全1的数组。

   ```python
   print(np.zeros(5))
   print(np.ones(4))
   """
   [0. 0. 0. 0. 0.]
   [1. 1. 1. 1.]
   """
   print(np.zeros((3,4)))
   print(np.ones((4,3)))
   """
   [[0. 0. 0. 0.]
    [0. 0. 0. 0.]
    [0. 0. 0. 0.]]
   [[1. 1. 1.]
    [1. 1. 1.]
    [1. 1. 1.]
    [1. 1. 1.]]
   """
   ```

### 2.2 多维数组运算

#### 2.2.1 基本算数运算

1. 二维数组与标量运算

   ```python
   arr = np.zeros((2,4))
   arr += 5
   print(arr)
   """
   [[5. 5. 5. 5.]
    [5. 5. 5. 5.]]
   """
   arr *= 2
   print(arr)
   """
   [[10. 10. 10. 10.]
    [10. 10. 10. 10.]]
   """
   ```

2. 二维数组与一维数组运算

   ```python
   arr = np.zeros((2,4))
   arr += np.array([1,2,3,4])
   print(arr)
   """
   [[1. 2. 3. 4.]
    [1. 2. 3. 4.]]
   """
   ```

3. 选定元素运算

   ```python
   flag = np.array([3,4,2,5])
   arr = np.zeros((4,6))
   arr[flag > 3] += np.array([1,2,3,4,5,6])
   print(flag>3)
   print(arr)
   """
   [False  True False  True]
   [[0. 0. 0. 0. 0. 0.]
    [1. 2. 3. 4. 5. 6.]
    [0. 0. 0. 0. 0. 0.]
    [1. 2. 3. 4. 5. 6.]]
   """
   ```

#### 2.2.2 函数和矩阵运算

1. 通用函数(ufunc)

   + 常用的一元函数(eg: np.abs(arr)等 )

   | 函数                            | 描述                                              |
   | ------------------------------- | ------------------------------------------------- |
   | abs、fabs                       | 计算整数、浮点数或负数的绝对值                    |
   | sqrt                            | 计算各元素的平方根                                |
   | square                          | 计算各元素的平方                                  |
   | exp                             | 计算各元素的指数                                  |
   | log、log10                      | 自然对数、底数为10的log                           |
   | sign                            | 计算各元素的正负号                                |
   | ceil                            | 计算各元素的ceiling值，即大于或等于该值的最小整数 |
   | floor                           | 计算各元素的floor值，即小于或等于该值的最大整数   |
   | cos、cosh、sin、sinh、tan、tanh | 普通和双曲型三角函数                              |

   + 常用的二元函数

   | 函数            | 描述                                                         |
   | --------------- | ------------------------------------------------------------ |
   | add             | 将数据中对应的元素相加                                       |
   | subtract        | 从第一个数组中践去第二个数组中的元素                         |
   | multiply        | 数组元素相乘                                                 |
   | divide          | 数组对应元素相除                                             |
   | power           | 对第一个数组中的元素A，根据第二个数组中的相应元素B，计算A^B^ |
   | mod             | 元素级的求模运算                                             |
   | copysign        | 将第二个数组中的值的符号复制给第一个数组中的值               |
   | equal,not_equal | 执行元素级的比较运算，产生布尔型数组                         |

2. 聚焦函数
   + 常用的聚集函数

   | 函数           | 描述                  |
   | -------------- | --------------------- |
   | sum            | 求和                  |
   | mean           | 算数平均值            |
   | min、max       | 最小值和最大值        |
   | argmin、argmax | 最小值和最大值的索引  |
   | cumsum         | 从0开始向前累加各元素 |
   | cumprod        | 从1开始向前累乘各元素 |

#### 2.2.3 随机数组生成函数

+ 常用函数

  | 函数    | 描述                                           |
  | ------- | ---------------------------------------------- |
  | random  | 随机产生[0,1)之间的浮点值                      |
  | randint | 随机生成给定范围的一组整数                     |
  | uniform | 随机生成给定范围内服从均匀分布的一组浮点数     |
  | choice  | 在给定的序列内随机选择元素                     |
  | normal  | 随机生成一组服从给定均值和方差的正态分布随机数 |

  ```python
  # 生成5*6的二维随机整数，随机数的取值是0或1
  np.random.randint(0,2,size = (5,6))
  """
  array([[0, 0, 0, 0, 1, 0],
         [1, 0, 1, 0, 0, 0],
         [1, 1, 1, 1, 1, 0],
         [1, 0, 1, 1, 0, 0],
         [0, 0, 1, 1, 0, 0]])
  """
  
  # 生成均值为0、方差为1服从正太分布的4*5二维数组
  np.random.normal(0,1,size = (4,5))
  """
  array([[ 0.27348588, -1.06847557, -0.84807463, -0.82102134,  0.31033654],
         [-0.76208868,  0.9522973 ,  0.53462609, -0.07880294,  1.08901491],
         [-1.45998785, -1.72776158, -1.09198982, -0.91469086, -1.2952753 ],
         [ 0.56222164, -1.13944672, -0.64216053, -0.03491689,  0.44231984]])
  """
  ```

## 第3章 数据汇总与统计



