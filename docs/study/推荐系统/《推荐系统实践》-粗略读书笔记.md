# 《推荐系统实践》-粗略读书笔记

> 为推荐系统的搭建做准备，时间比较紧迫，暂时不细读了。

# 1. 第1章 好的推荐

## 1.1 什么是推荐系统

+ 推荐系统的基本任务是联系用户和物品，解决信息过载的问题

+ 从物品的角度出发，推荐系统可以更好地发掘物品的长尾（long tail）。主流商品代表绝大多数用户的需求，而长尾商品代表**少数人的个性化需求**。推荐系统通过发掘用户的行为，找到用户的个性化需求，从而将长尾商品准确地推荐给需要它的用户，帮助用户发现那些他们感兴趣但很难发现的商品。

+ 常见的几种推荐方式

  + 社会化推荐（social recommendation）

    用户间推荐

  + 基于内容的推荐 （content-based filtering）

    根据用户历史兴趣推荐类似内容

  + 基于协同过滤的推荐（collaborative filtering）

    给用户推荐兴趣相似的用户所感兴趣的内容

## 1.2 个性化推荐系统的应用

​	个性化推荐系统通过**分析大量用户行为日志**，给不同用户提供不同的个性化页面展示，来提高网站的点击率和转化率。

​	几乎所有的推荐系统应用都是由三部分构成：

+ **前台的展示页面**
+ **后台的日志系统**
+ **推荐算法系统**

### 1.2.1 电子商务

1. 亚马逊个性化推荐系统列表

   **基于物品推荐**

   + 推荐结果的标题、缩略图以及其他内容属性
   + 推荐结果的平均分
   + 推荐理由

### 1.2.2 电影和视频网站

1. Netflix电影推荐界面

   **基于物品推荐**

   + 电影的标题和海报
   + 用户反馈模块——包括Play（播放）、评分和Not Interested（不感兴趣）3种
   + 推荐理由——因为用户曾经喜欢过别的电影

### 1.2.3 个性化音乐网络电台

个性化推荐的成功应用需要两个条件：

1. 信息过载。因为如果用户可以很容易地从所有物品中找到喜欢的物品，就不需要个性化推荐了。
2. 用户大部分时候没有特别明确的需求。用户如果有明确的需求，可直接通过搜索引擎找到感兴趣的物品。

著名个性化音乐推荐产品：Pandora、Last.fm、豆瓣电台

Last.fm记录了所有用户的听歌记录以及用户对歌曲的反馈，在这一基础上计算出不同用户在歌曲上的喜好相似度，从而给用户推荐和他有相似听歌爱好的其他用户喜欢的歌曲。

​	音乐推荐是推荐系统里非常特殊的领域。2011年的Recsys大会专门邀请了Pandora的研究人员对音乐推荐进行了演讲。演讲人总结了音乐推荐的如下特点。

+ 物品空间大 物品数很多，物品空间很大，这主要是相对于书和电影而言。

+ 消费每首歌的代价很小 对于在线音乐来说，音乐都是免费的，不需要付费。

+ 物品种类丰富 音乐种类丰富，有很多的流派。

+ 听一首歌耗时很少 听一首音乐的时间成本很低，不太浪费用户的时间，而且用户大都把音乐作为背景声音，同时进行其他工作。

+ 物品重用率很高 每首歌用户会听很多遍，这和其他物品不同，比如用户不会反复看一个电影，不会反复买一本书。

+ 用户充满激情 用户很有激情，一个用户会听很多首歌。

+ 上下文相关 用户的口味很受当时上下文的影响，这里的上下文主要包括用户当时的心情（比如沮丧的时候喜欢听励志的歌曲）和所处情境（比如睡觉前喜欢听轻音乐）。

+ 次序很重要 用户听音乐一般是按照一定的次序一首一首地听。

+ 很多播放列表资源 很多用户都会创建很多个人播放列表。

+ 不需要用户全神贯注 音乐不需要用户全神贯注地听，很多用户将音乐作为背景声音。

+ 高度社会化

### 1.2.4 社交网络

代表：Twitter、FaceBook

社交网络中的个性化推荐技术主要应用在3个方面：

+ 利用用户的社交网络信息对用户进行个性化的物品推荐；

+ 信息流的会话推荐；

+ 给用户推荐好友。

### 1.2.5 个性化阅读

​	目前互联网上的个性化阅读工具很多，国际知名的有Google Reader，国内有鲜果网等。

+ Google Reader是一款流行的社会化阅读工具。它允许用户关注自己感兴趣的人，然后看到所关注用户分享的文章。
+ 个性化阅读工具Zite则是收集用户对文章的偏好信息。
+ Digg首先根据用户的Digg历史计算用户之间的兴趣相似度，然后给用户推荐和他兴趣相似的用户喜欢的文章。

### 1.2.6 基于位置的服务

+ Foursquare推出了探索功能，给用户推荐好友在附近的情况

### 1.2.7 个性化邮件

+ 推荐系统Tapestry，协同过滤筛选信息，通过分析用户阅读邮件的历史行为和习惯对新邮件进行重新排序，从而提高用户的工作效率。
+ 谷歌的研究人员在这个问题上也进行了深入研究，于2010年推出了优先级收件箱功能。该产品通过分析用户对邮件的历史行为，找到用户感兴趣的邮件，展示在一个专门的收件箱里。用户每天可以先浏览这个邮箱里的邮件，再浏览其他邮件。

### 1.2.8 个性化广告

> [网络广告中，CPC、CPA、CPM 的定义各是怎样的？](https://www.zhihu.com/question/20416888)
>
> 1. CPM（Cost Per Mille） ：展现成本，或者叫千人展现成本
> 2. CPC（Cost Per Click） 点击成本，即每产生一次点击所花费的成本
> 3. CPA（Cost Per Action）：每行动成本。即按行动收费

​	广告是互联网公司生存的根本。很多互联网公司的盈利模式都是基于广告的，而广告的CPC、CPM直接决定了很多互联网公司的收入。

​	个性化广告投放和狭义个性化推荐的区别是，个性化推荐着重于帮助用户找到可能令他们感兴趣的物品，而**广告推荐着重于帮助广告找到可能对它们感兴趣的用户**，即一个是以用户为核心，而另一个以广告为核心。目前的个性化广告投放技术主要分为3种。

+  上下文广告 通过分析用户正在浏览的网页内容，投放和网页内容相关的广告。代表系统是谷歌的Adsense。

+ 搜索广告 通过分析用户在当前会话中的搜索记录，判断用户的搜索目的，投放和用户目的相关的广告。

+ 个性化展示广告 我们经常在很多网站看到大量展示广告（就是那些大的横幅图片），它们是根据用户的兴趣，对不同用户投放不同的展示广告。雅虎是这方面研究的代表。

## 1.3 推荐系统评测

> 看到这就想到最近美团爆出杀熟的操作。三方共赢这种美好的愿望还是想想就好，哈哈。

​	一个完整的推荐系统一般存在3个参与方：

+ 用户
+ 物品提供者
+ 提供推荐系统的网站

​	在评测一个推荐算法时，需要同时考虑三方的利益，一个好的推荐系统是能够令三方共赢的系统。

### 1.3.1 推荐系统实验方法

在推荐系统中，主要有3种评测推荐效果的实验方法：

+ 离线实验（offline experiment）
+ 用户调查（user study）
+ 在线实验（online experiment）

#### 1. 离线实验

离线实验的方法一般由如下几个步骤构成：

1. 通过日志系统获得用户行为数据，并按照一定格式生成一个标准的数据集；

2. 将数据集按照一定的规则分成训练集和测试集；

3. 在训练集上训练用户兴趣模型，在测试集上进行预测；

4. 通过事先定义的离线指标评测算法在测试集上的预测结果。

从上面的步骤可以看到，**推荐系统的离线实验都是在数据集上完成的**，也就是说它不需要一个实际的系统来供它实验，而只要有一个从实际系统日志中提取的数据集即可。这种实验方法的好处是不需要真实用户参与，可以直接快速地计算出来，从而方便、快速地测试大量不同的算法。

它的**主要缺点是无法获得很多商业上关注的指标，如点击率、转化率等**，而找到和商业指标非常相关的离线指标也是很困难的事情。

| 优点                     | 缺点                             |
| ------------------------ | -------------------------------- |
| 不需要对实际系统的控制权 | 无法计算商业上关心的指标         |
| 不需要用户参与实验       | 离线实验的指标和商业指标存在差异 |
| 速度快，可以测试大量算法 |                                  |

#### 2. 用户调查

​	注意，离线实验的指标和实际的商业指标存在差距，比如预测准确率和用户满意度之间就存在很大差别，**高预测准确率不等于高用户满意度**。

​	用户调查的优缺点也很明显。它的优点是可以获得很多体现用户主观感受的指标，相对在线实验风险很低，出现错误后很容易弥补。缺点是招募测试用户代价较大，很难组织大规模的测试用户，因此会使测试结果的统计意义不足。此外，在很多时候设计双盲实验非常困难，而且用户在测试环境下的行为和真实环境下的行为可能有所不同，因而在测试环境下收集的测试指标可能在真实环境下无法重现。

#### 3. 在线实验

> [黄一能：什么是科学的AB测试？谈谈分层实验和流量正交 ](https://www.sohu.com/a/343208894_713733)
>
> 科学的AB实验要求保证每次实验只有一个变量，各组其他所有元素都必须保持一致。如果每个变量都独立切分流量会大大制约实验的效率，一是实验流量变少，得出显著结果的时间会拉长。二是可以并行的实验量受到了制约。如果不切分流量实验，无法验证效果的变化究竟是那个改动带来的。
>
> [AB测试中两个常见的问题，谈谈流量分层和置信度](https://zhuanlan.zhihu.com/p/108317075)

​	在完成离线实验和必要的用户调查后，可以将推荐系统上线做**AB测试**，将它和旧的算法进行比较。

​	AB测试是一种很常用的在线评测算法的实验方法。它通过一定的规则将用户随机分成几组，并对不同组的用户采用不同的算法，然后通过统计不同组用户的各种不同的评测指标比较不同算法，比如可以统计不同组用户的点击率，通过点击率比较不同算法的性能。

​	网站http://www.abtests.com/，给出了很多通过实际AB测试提高网站用户满意度的例子，从中我们可以学习到如何进行合理的AB测试。

​	**AB测试的优点是可以公平获得不同算法实际在线时的性能指标**，包括商业上关注的指标。AB测试的**缺点主要是周期比较长**，必须进行长期的实验才能得到可靠的结果。因此一般不会用AB测试测试所有的算法，而只是用它测试那些在离线实验和用户调查中表现很好的算法。

​	切分流量是AB测试中的关键，不同的层以及控制这些层的团队需要从一个统一的地方获得自己AB测试的流量，而不同层之间的流量应该是正交的。

​	<small>下图是一个简单的AB测试系统。用户进入网站后，流量分配系统决定用户是否需要被进行AB测试，如果需要的话，流量分配系统会给用户打上在测试中属于什么分组的标签。然后用户浏览网页，而用户在浏览网页时的行为都会被通过日志系统发回后台的日志数据库。此时，如果用户有测试分组的标签，那么该标签也会被发回后台数据库。在后台，实验人员的工作首先是配置流量分配系统，决定满足什么条件的用户参加什么样的测试。其次，实验人员需要统计日志数据库中的数据，通过评测系统生成不同分组用户的实验报告，并比较和评测实验结果。</small>

![img](http://www.ituring.com.cn/figures/2012/tuijinxitongshijian/05.D%2001%20Z/image23.png)



----

一般来说，一个新的推荐算法最终上线，需要完成上面所说的3个实验。

+ 首先，需要通过离线实验证明它在很多离线指标上优于现有的算法。
+ 然后，需要通过用户调查确定它的用户满意度不低于现有的算法。

+ 最后，通过在线的AB测试确定它在我们关心的指标上优于现有的算法。

### 1.3.2 评测指标

#### 1. 用户满意度

​	用户满意度没有办法离线计算，只能通过用户调查或者在线实验获得。

​	用户调查获得用户满意度主要是通过调查问卷的形式。而在线系统中，用户满意度主要通过一些对用户行为的统计得到。更一般的情况下，我们可以用点击率、用户停留时间和转化率等指标度量用户的满意度。

#### 2. 预测准确度

​	预测准确度度量一个推荐系统或者推荐算法预测用户行为的能力。该指标可以通过离线实验计算。

​	在计算该指标时需要有一个离线的数据集，该数据集包含用户的历史行为记录。然后，将该数据集通过时间分成训练集和测试集。最后，通过在训练集上建立用户的行为和兴趣模型预测用户在测试集上的行为，并计算预测行为和测试集上实际行为的重合度作为预测准确度。

##### 评分预测

​	预测用户对物品评分的行为称为评分预测。

##### TopN推荐

​	网站在提供推荐服务时，一般是给用户一个个性化的推荐列表，这种推荐叫做**TopN推荐**。TopN推荐的预测准确率一般通过准确率（precision）/召回率（recall）度量。

​	有的时候，为了全面评测TopN推荐的准确率和召回率，一般会选取不同的推荐列表长度N，计算出一组准确率/召回率，然后画出准确率/召回率曲线（precision/recall curve）。

##### 关于评分预测和TopN推荐的讨论

​	评分预测一直是推荐系统研究的热点，绝大多数推荐系统的研究都是基于用户评分数据的评分预测。

#### 3. 覆盖率

> [请问什么是基尼系数，怎样计算出来的？](https://zhidao.baidu.com/question/1797381608016293707.html)

​	覆盖率（coverage）描述一个推荐系统对物品长尾的发掘能力。覆盖率是一个内容提供商会关心的指标。

​	以图书推荐为例，出版社可能会很关心他们的书有没有被推荐给用户。覆盖率为100%的推荐系统可以将每个物品都推荐给至少一个用户。此外，从上面的定义也可以看到，热门排行榜的推荐覆盖率是很低的，它只会推荐那些热门的物品，这些物品在总物品中占的比例很小。一个好的推荐系统不仅需要有比较高的用户满意度，也要有较高的覆盖率。

​	可以通过研究物品在推荐列表中出现次数的分布描述推荐系统挖掘长尾的能力。如果这个分布比较平，那么说明推荐系统的覆盖率较高，而如果这个分布较陡峭，说明推荐系统的覆盖率较低。

​	社会学领域有一个著名的**马太效应，即所谓强者更强，弱者更弱的效应**。如果一个系统会增大热门物品和非热门物品的流行度差距，让热门的物品更加热门，不热门的物品更加不热门，那么这个系统就有马太效应。

​	推荐系统的初衷是希望消除马太效应，使得各种物品都能被展示给对它们感兴趣的某一类人群。但是，很多研究表明现在主流的推荐算法（比如协同过滤算法）是具有马太效应的。**评测推荐系统是否具有马太效应的简单办法就是使用基尼系数**。（如果G1是从初始用户行为中计算出的物品流行度的基尼系数，G2是从推荐列表中计算出的物品流行度的基尼系数，那么如果G2 > G1，就说明推荐算法具有马太效应。）

#### 4. 多样性

​	为了满足用户广泛的兴趣，推荐列表需要能够覆盖用户不同的兴趣领域，即推荐结果需要具有多样性。多样性推荐列表的好处用一句俗话表述就是“不在一棵树上吊死”。